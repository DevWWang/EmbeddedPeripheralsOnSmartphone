# EmbeddedPeripheralsOnSmartphone
#### BLE connection and data exchange between STM32F4Disocvery board and Android App via a Nucleo board with BLE shield.

This project aimed at building the communication between the Discovery board and an Android phone via Bluetooth Low Energy connection that is supported by STM32F401RE Nucleo board with an IDB04A1 shield. More specifically, the Discovery board is responsible for measuring its temperature and its orientation. Also, it requires a double tap feature using the accelerometer in order to wake up the smart phone. On the other hand, user can control LEDs on the Discovery board, including the intensity (PWM), the speed of rotation, and the direction of rotation through the application on the Android device.

Several operating functions appear to execute simultaneously on Discovery board. First, it digitizes temperature readings in analog voltage retrieved from the sensor at a particular frequency using the analog to digital converter (ADC). During the conversion, there are few forms of noises are introduced such as electromagnetic noise, thermal noise, and quantization noise. Second, the system calculates the roll and pitch angle based on its three dimensional measurements using the accelerometer. Last, the board detects whether there is a double tap action via an accelerometer algorithm then notifies the smart phone.

The Android device is used to display the temperature and the values of roll and pitch angles received from the operating processor which is the Discovery board. Additionally, the user has to be able to turn on and off all four LEDs and determine the order of how the lights rotate. However, the application cannot communicate directly with the Discovery board. The Nucleo board along with a shield provides a way for user to easily create and access the services and their characteristic attributes for the application. The data transmission between the Nucleo board and the smartphone occurs after the application searches for BLE device and set up the connection.

As the Nucleo board is not responsible for operating any measurements, a simple built-in communication protocol is implemented for two processors. While the data (e.g., the temperature and the angles) is ready, the Discovery board transfers data to the Nucleo board over serial peripheral interface (SPI) bus. Two boards can send and receive data in both direction using a master/slave architecture by specifying the four signals: clock, MISO (master data input, slave data output), MOSI (master data output, slave data input), and slave select.

Therefore, the system employs multiple functions such as temperature sensor, position sensor, communication between boards, and display. There were few challenges encountered while dealing with the specification listed above. Our challenges include: properly transmitting data between processors with different frequencies, defining whether the data transferred is meaningful or a dummy byte, designing the required services with their characteristics for BLE device, properly calibrating new Discovery board algorithms, and of course, communication with the Android app to exchange data.
